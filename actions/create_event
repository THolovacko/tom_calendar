#! /usr/bin/ruby

require_relative '../lib/tom_calendar.rb'


cookie_session_id = ENV['HTTP_COOKIE']&.split(';')&.find{ |cookie| cookie.match?('session_id') }&.sub('session_id=','')&.strip
cookie_session_id = nil if cookie_session_id == ''

unless cookie_session_id
  print StatusCodeStr::BAD_REQUEST
  return
end

session_id    = JSON.parse(cookie_session_id)
dynamodb      = Aws::DynamoDB::Client.new(region: ENV['AWS_REGION'])
request_input = JSON.parse(ARGF.first)

result = request_input

print "Content-type: application/json\n\n#{result.to_json}"
